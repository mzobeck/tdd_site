{
  "hash": "6d2af4eb12352091268d9c6e51fc4673",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Core Concepts for Trustworthy Prognosis Modeling\"\nauthor: \"Mark Zobeck\"\ndate: 2024-12-04\nimage: coffee-chillin.png\ncategories: [\"Statistics & Heuristics\"]\ntags:\n  - Frequentist Statistics\n  - Clinical Prediction Modeling\n  - Prognosis Modeling\n  - Data science\neditor: \n  markdown: \n    wrap: 72\neditor_options: \n  chunk_output_type: console\n---\n\n\n![](coffee-chillin.png){.preview-image}\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n# Introduction\n\n## Choosing the Number of Parameters and Fitting the Model\n\n\n* Clinical trial of estrogen for prostate cancer\n* Response is time to death, all causes\n* Base analysis on Cox proportional hazards model [@cox72]\n* $S(t | X)$ = probability of surviving at least to time $t$ given set of predictor values $X$\n* $S(t | X) = S_{0}(t)^{\\exp(X\\beta)}$\n* Censor time to death at time of last follow-up for patients\n        still alive at end of study (treat survival time for pt.\\\n        censored at 24m as 24m+)\n* Use simple, partial approaches to data reduction\n* Use `transcan` for single imputation\n* Again combine last 2 categories for `ekg,pf`\n* See if we can use a full additive model (4 knots for continuous $X$)\n\n| Predictor | Name | d.f. | Original Levels |\n|---|---|---|---|\nDose of estrogen                    |   `rx`     | 3     | placebo, 0.2, 1.0, 5.0 mg estrogen |\nAge in years                        |   `age`    | 3     | |\nWeight index: wt(kg)-ht(cm)+200     |   `wt`     | 3     | |\nPerformance rating                  |   `pf`     | 2     | normal, in bed <50% of time, in bed >50%, in bed always |\nHistory of cardiovascular disease   |   `hx`     | 1     |present/absent |\nSystolic blood pressure/10          |   `sbp`    | 3     | |\nDiastolic blood pressure/10         |   `dbp`    | 3     | |\nElectrocardiogram code              |   `ekg`    | 5     | normal, benign, rhythm disturb., block, strain, old myocardial infarction, new MI |\nSerum hemoglobin (g/100ml)          |   `hg`     | 3     | |\nTumor size (cm$^2$)                 |   `sz`     | 3     | |\nStage/histologic grade combination  |   `sg`     | 3     | |\nSerum prostatic acid phosphatase    |   `ap`     | 3     | |\nBone metastasis                     |   `bm`     | 1     | present/absent |\n\n* Total of 36 candidate d.f.\n* Impute missings and estimate shrinkage  \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n\n<p><strong>Cox Proportional Hazards Model</strong></p>\n\n<pre>\ncph(formula = S ~ rx + rcs(age, 4) + rcs(wt, 4) + pf + hx + rcs(sbp, \n    4) + rcs(dbp, 4) + ekg + rcs(hg, 4) + rcs(sg, 4) + rcs(sz, \n    4) + rcs(log(ap), 4) + bm)\n</pre>\n\n<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >\n<thead>\n<tr>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Model Tests</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Discrimination<br>Indexes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Obs 502</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>LR χ<sup>2</sup> 136.22</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup>2</sup> 0.238</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Events 354</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>d.f. 36</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup><span style='font-size: 70%;'>2</span></sup><sub style='position: relative; left: -.47em; bottom: -.4em;'><span style='font-size: 70%;'>36,502</span></sub> 0.181</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Center -2.9933</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>Pr(>χ<sup>2</sup>) 0.0000</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup><span style='font-size: 70%;'>2</span></sup><sub style='position: relative; left: -.47em; bottom: -.4em;'><span style='font-size: 70%;'>36,354</span></sub> 0.247</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>Score χ<sup>2</sup> 143.62</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>D</i><sub>xy</sub> 0.333</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></td>\n<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'>Pr(>χ<sup>2</sup>) 0.0000</td>\n<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'></td>\n</tr>\n</tbody>\n</table>\n\n```\n\n:::\n:::\n\n\n* Global LR $\\chi^2$ is 135 and very significant $\\rightarrow$\n        modeling warranted   \n* AIC on $\\chi^2$ scale = $136.2 - 2 \\times 36 = 64.2$\n* Rough shrinkage: 0.74 ($\\frac{136.2 - 36}{136.2}$)\n* Informal data reduction (increase for `ap`)  \n\n| Variables | Reductions | d.f. Saved |\n|-----------|------------|------------|\n| `wt`      | Assume variable not important enough for 4 knots; use 3 | 1  |\n| `pf`      | Assume linearity                                 | 1  |\n| `hx,ekg`  | Make new 0,1,2 variable and assume linearity: 2=`hx` and `ekg` not normal or benign, 1=either, 0=none | 5  |\n| `sbp,dbp` | Combine into mean arterial bp and use 3 knots: map=$\\frac{2}{3}$ `dbp` $+ \\frac{1}{3}$ `sbp`  | 4  |\n| `sg`      | Use 3 knots                                      | 1  |\n| `sz`      | Use 3 knots                                      | 1  |\n| `ap`      | Look at shape of effect of `ap` in detail, and take log before expanding as spline to achieve stability: add 1 knot    | -1  |\n\n: Data reduction strategy\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n\n<p><strong>Cox Proportional Hazards Model</strong></p>\n\n<pre>\ncph(formula = S ~ rx + rcs(age, 4) + rcs(wt, 3) + pf.coded + \n    heart + rcs(map, 3) + rcs(hg, 4) + rcs(sg, 3) + rcs(sz, 3) + \n    rcs(log(ap), 5) + bm, x = TRUE, y = TRUE, surv = TRUE, time.inc = 5 * \n    12)\n</pre>\n\n<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >\n<thead>\n<tr>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Model Tests</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black; text-align: center;'>Discrimination<br>Indexes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Obs 502</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>LR χ<sup>2</sup> 118.37</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup>2</sup> 0.210</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Events 354</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>d.f. 24</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup><span style='font-size: 70%;'>2</span></sup><sub style='position: relative; left: -.47em; bottom: -.4em;'><span style='font-size: 70%;'>24,502</span></sub> 0.171</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'>Center -2.4307</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>Pr(>χ<sup>2</sup>) 0.0000</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>R</i><sup><span style='font-size: 70%;'>2</span></sup><sub style='position: relative; left: -.47em; bottom: -.4em;'><span style='font-size: 70%;'>24,354</span></sub> 0.234</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'>Score χ<sup>2</sup> 125.58</td>\n<td style='min-width: 9em; border-right: 1px solid black; text-align: center;'><i>D</i><sub>xy</sub> 0.321</td>\n</tr>\n<tr>\n<td style='min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black; text-align: center;'></td>\n<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'>Pr(>χ<sup>2</sup>) 0.0000</td>\n<td style='min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black; text-align: center;'></td>\n</tr>\n</tbody>\n</table>\n\n```\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<table class='gmisc_table' style='border-collapse: collapse; font-size:1em;; font-size:1em;; font-size:1em;' >\n<thead>\n<tr><td colspan='4' style='text-align: left;'>\nLikelihood Ratio Statistics for <code style=\"font-size:0.8em\">S</code></td></tr>\n<tr><th style='border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;'></th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'><i>χ<sup>2</sup></i></th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'>d.f.</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'><i>P</i></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style='text-align: left;'>rx</td>\n<td style='padding-left:2ex; text-align: right;'>  8.46</td>\n<td style='padding-left:2ex; text-align: right;'> 3</td>\n<td style='padding-left:2ex; text-align: right;'>0.0373</td>\n</tr>\n<tr>\n<td style='text-align: left;'>age</td>\n<td style='padding-left:2ex; text-align: right;'> 11.98</td>\n<td style='padding-left:2ex; text-align: right;'> 3</td>\n<td style='padding-left:2ex; text-align: right;'>0.0074</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  8.31</td>\n<td style='padding-left:2ex; text-align: right;'> 2</td>\n<td style='padding-left:2ex; text-align: right;'>0.0157</td>\n</tr>\n<tr>\n<td style='text-align: left;'>wt</td>\n<td style='padding-left:2ex; text-align: right;'>  7.80</td>\n<td style='padding-left:2ex; text-align: right;'> 2</td>\n<td style='padding-left:2ex; text-align: right;'>0.0202</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  2.45</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'>0.1176</td>\n</tr>\n<tr>\n<td style='text-align: left;'>pf.coded</td>\n<td style='padding-left:2ex; text-align: right;'>  3.49</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'>0.0616</td>\n</tr>\n<tr>\n<td style='text-align: left;'>heart</td>\n<td style='padding-left:2ex; text-align: right;'> 23.82</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'><0.0001</td>\n</tr>\n<tr>\n<td style='text-align: left;'>map</td>\n<td style='padding-left:2ex; text-align: right;'>  0.05</td>\n<td style='padding-left:2ex; text-align: right;'> 2</td>\n<td style='padding-left:2ex; text-align: right;'>0.9777</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  0.04</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'>0.8339</td>\n</tr>\n<tr>\n<td style='text-align: left;'>hg</td>\n<td style='padding-left:2ex; text-align: right;'> 11.44</td>\n<td style='padding-left:2ex; text-align: right;'> 3</td>\n<td style='padding-left:2ex; text-align: right;'>0.0095</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  7.53</td>\n<td style='padding-left:2ex; text-align: right;'> 2</td>\n<td style='padding-left:2ex; text-align: right;'>0.0231</td>\n</tr>\n<tr>\n<td style='text-align: left;'>sg</td>\n<td style='padding-left:2ex; text-align: right;'>  1.65</td>\n<td style='padding-left:2ex; text-align: right;'> 2</td>\n<td style='padding-left:2ex; text-align: right;'>0.4386</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  0.05</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'>0.8295</td>\n</tr>\n<tr>\n<td style='text-align: left;'>sz</td>\n<td style='padding-left:2ex; text-align: right;'> 11.81</td>\n<td style='padding-left:2ex; text-align: right;'> 2</td>\n<td style='padding-left:2ex; text-align: right;'>0.0027</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  0.06</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'>0.7998</td>\n</tr>\n<tr>\n<td style='text-align: left;'>ap</td>\n<td style='padding-left:2ex; text-align: right;'>  6.22</td>\n<td style='padding-left:2ex; text-align: right;'> 4</td>\n<td style='padding-left:2ex; text-align: right;'>0.1836</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>Nonlinear</i></td>\n<td style='padding-left:2ex; text-align: right;'>  5.82</td>\n<td style='padding-left:2ex; text-align: right;'> 3</td>\n<td style='padding-left:2ex; text-align: right;'>0.1208</td>\n</tr>\n<tr>\n<td style='text-align: left;'>bm</td>\n<td style='padding-left:2ex; text-align: right;'>  0.03</td>\n<td style='padding-left:2ex; text-align: right;'> 1</td>\n<td style='padding-left:2ex; text-align: right;'>0.8674</td>\n</tr>\n<tr>\n<td style='text-align: left;'><span style=\"font-weight:bold\">TOTAL NONLINEAR</span></td>\n<td style='padding-left:2ex; text-align: right;'> 22.73</td>\n<td style='padding-left:2ex; text-align: right;'>11</td>\n<td style='padding-left:2ex; text-align: right;'>0.0193</td>\n</tr>\n<tr>\n<td style='border-bottom: 2px solid grey; text-align: left;'><span style=\"font-weight:bold\">TOTAL</span></td>\n<td style='padding-left:2ex; border-bottom: 2px solid grey; text-align: right;'>118.37</td>\n<td style='padding-left:2ex; border-bottom: 2px solid grey; text-align: right;'>24</td>\n<td style='padding-left:2ex; border-bottom: 2px solid grey; text-align: right;'><0.0001</td>\n</tr>\n</tbody>\n</table>\n```\n\n:::\n:::\n\n\n* Savings of 12 d.f.  \n* AIC=70, shrinkage 0.80\n\n\n## Checking Proportional Hazards {#sec-coxcase-check-ph}\n\n* This is our tentative model\n* Examine distributional assumptions using scaled Schoenfeld residuals\n* Complication arising from predictors using multiple d.f.\n* Transform to 1 d.f. empirically using $X\\hat{\\beta}$\n* `cox.zph` does this automatically\n* Following analysis approx. since internal coefficients estimated\n\n\n\n::: {.cell}\n\n:::\n\n\n\n* Fit `f.short` has same LR $\\chi^2$ of 118 as the fit `f`,    but with falsely low d.f.\n* All $\\beta=1$\n\n\n\n::: {.cell cap='Raw and spline-smoothed scaled Schoenfeld residuals for dose of estrogen, nonlinearly coded from the Cox model fit, with $\\pm$ 2 standard errors.' scap='Schoenfeld residuals for dose of estrogen in Cox model'}\n::: {.cell-output .cell-output-stdout}\n\n```\n                   chisq df    p\nrx              4.07e+00  3 0.25\nrcs(age, 4)     4.27e+00  3 0.23\nrcs(wt, 3)      2.22e-01  2 0.89\npf.coded        5.34e-02  1 0.82\nheart           4.95e-01  1 0.48\nrcs(map, 3)     3.20e+00  2 0.20\nrcs(hg, 4)      5.26e+00  3 0.15\nrcs(sg, 3)      1.01e+00  2 0.60\nrcs(sz, 3)      3.07e-01  2 0.86\nrcs(log(ap), 5) 3.59e+00  4 0.47\nbm              2.11e-06  1 1.00\nGLOBAL          2.30e+01 24 0.52\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Raw and spline-smoothed scaled Schoenfeld residuals for dose of estrogen, nonlinearly coded from the Cox model fit, with $\\pm$ 2 standard errors.](index_files/figure-html/fig-coxcase-rx-ph-1.png){#fig-coxcase-rx-ph fig-scap='Schoenfeld residuals for dose of estrogen in Cox model' width=672}\n:::\n:::\n\n\n* None of the effects significantly change over time\n* Global test of PH $P=0.52$\n\n\n## Testing Interactions\n\n* Will ignore non-PH for dose even though it makes sense\n* More accurate predictions could be obtained using stratification\n        or time dep. cov.\n* Test all interactions with dose  <br> Reduce to 1 d.f. as before\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<table class='gmisc_table' style='border-collapse: collapse; font-size:1em;; font-size:1em;; font-size:1em;' >\n<thead>\n<tr><td colspan='4' style='text-align: left;'>\nLikelihood Ratio Statistics for <code style=\"font-size:0.8em\">S</code></td></tr>\n<tr><th style='border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;'></th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'><i>χ<sup>2</sup></i></th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'>d.f.</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: right;'><i>P</i></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style='text-align: left;'>z.dose  (Factor+Higher Order Factors)</td>\n<td style='padding-left:2ex; text-align: right;'> 20.65</td>\n<td style='padding-left:2ex; text-align: right;'>11</td>\n<td style='padding-left:2ex; text-align: right;'>0.0371</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>All Interactions</i></td>\n<td style='padding-left:2ex; text-align: right;'> 11.89</td>\n<td style='padding-left:2ex; text-align: right;'>10</td>\n<td style='padding-left:2ex; text-align: right;'>0.2926</td>\n</tr>\n<tr>\n<td style='text-align: left;'>z.other  (Factor+Higher Order Factors)</td>\n<td style='padding-left:2ex; text-align: right;'>121.19</td>\n<td style='padding-left:2ex; text-align: right;'>20</td>\n<td style='padding-left:2ex; text-align: right;'><0.0001</td>\n</tr>\n<tr>\n<td style='text-align: left;'> <i>All Interactions</i></td>\n<td style='padding-left:2ex; text-align: right;'> 11.89</td>\n<td style='padding-left:2ex; text-align: right;'>10</td>\n<td style='padding-left:2ex; text-align: right;'>0.2926</td>\n</tr>\n<tr>\n<td style='text-align: left;'>z.dose × z.other  (Factor+Higher Order Factors)</td>\n<td style='padding-left:2ex; text-align: right;'> 11.89</td>\n<td style='padding-left:2ex; text-align: right;'>10</td>\n<td style='padding-left:2ex; text-align: right;'>0.2926</td>\n</tr>\n<tr>\n<td style='border-bottom: 2px solid grey; text-align: left;'><span style=\"font-weight:bold\">TOTAL</span></td>\n<td style='padding-left:2ex; border-bottom: 2px solid grey; text-align: right;'>130.26</td>\n<td style='padding-left:2ex; border-bottom: 2px solid grey; text-align: right;'>21</td>\n<td style='padding-left:2ex; border-bottom: 2px solid grey; text-align: right;'><0.0001</td>\n</tr>\n</tbody>\n</table>\n```\n\n:::\n:::\n\n\n\n\n## Describing Predictor Effects\n\n \n\n* Plot relationship between each predictor and $\\log \\lambda$\n\n\n::: {.cell h='6' w='6.75' cap='Shape of each predictor on log hazard of death.  $Y$-axis shows $X\\hat{\\beta}$, but the predictors not plotted are set to reference values.  Note the highly non-monotonic relationship with `ap`, and the increased slope after age 70 which has been found in outcome models for various diseases.' scap='Shapes of predictors for log hazard in prostate cancer'}\n::: {.cell-output-display}\n![Shape of each predictor on log hazard of death.  $Y$-axis shows $X\\hat{\\beta}$, but the predictors not plotted are set to reference values.  Note the highly non-monotonic relationship with `ap`, and the increased slope after age 70 which has been found in outcome models for various diseases.](index_files/figure-html/fig-coxcase-shapes-1.png){#fig-coxcase-shapes fig-scap='Shapes of predictors for log hazard in prostate cancer' width=672}\n:::\n:::\n\n\n## Validating the Model\n\n \n\n* Validate for $D_{xy}$ and slope shrinkage\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >\n<thead>\n<tr><th style='border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey; text-align: center;'>Index</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Original<br>Sample</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Training<br>Sample</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Test<br>Sample</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Optimism</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Corrected<br>Index</th>\n<th style='font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Successful<br>Resamples</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style='text-align: left;'><i>D<sub>xy</sub></i></td>\n<td style='text-align: center;'>0.3208</td>\n<td style='text-align: center;'>0.3494</td>\n<td style='text-align: center;'>0.2953</td>\n<td style='text-align: center;'>0.0541</td>\n<td style='text-align: center;'>0.2667</td>\n<td style='text-align: center;'>300</td>\n</tr>\n<tr>\n<td style='text-align: left;'><i>R<sup>2</sup></i></td>\n<td style='text-align: center;'>0.2101</td>\n<td style='text-align: center;'>0.2481</td>\n<td style='text-align: center;'>0.1756</td>\n<td style='text-align: center;'>0.0724</td>\n<td style='text-align: center;'>0.1377</td>\n<td style='text-align: center;'>300</td>\n</tr>\n<tr>\n<td style='text-align: left;'>Slope</td>\n<td style='text-align: center;'>1</td>\n<td style='text-align: center;'>1</td>\n<td style='text-align: center;'>0.7863</td>\n<td style='text-align: center;'>0.2137</td>\n<td style='text-align: center;'>0.7863</td>\n<td style='text-align: center;'>300</td>\n</tr>\n<tr>\n<td style='text-align: left;'><i>D</i></td>\n<td style='text-align: center;'>0.0292</td>\n<td style='text-align: center;'>0.0354</td>\n<td style='text-align: center;'>0.0239</td>\n<td style='text-align: center;'>0.0116</td>\n<td style='text-align: center;'>0.0176</td>\n<td style='text-align: center;'>300</td>\n</tr>\n<tr>\n<td style='text-align: left;'><i>U</i></td>\n<td style='text-align: center;'>-5e-04</td>\n<td style='text-align: center;'>-5e-04</td>\n<td style='text-align: center;'>0.0024</td>\n<td style='text-align: center;'>-0.0029</td>\n<td style='text-align: center;'>0.0024</td>\n<td style='text-align: center;'>300</td>\n</tr>\n<tr>\n<td style='text-align: left;'><i>Q</i></td>\n<td style='text-align: center;'>0.0297</td>\n<td style='text-align: center;'>0.0359</td>\n<td style='text-align: center;'>0.0215</td>\n<td style='text-align: center;'>0.0144</td>\n<td style='text-align: center;'>0.0153</td>\n<td style='text-align: center;'>300</td>\n</tr>\n<tr>\n<td style='border-bottom: 2px solid grey; text-align: left;'><i>g</i></td>\n<td style='border-bottom: 2px solid grey; text-align: center;'>0.7174</td>\n<td style='border-bottom: 2px solid grey; text-align: center;'>0.7999</td>\n<td style='border-bottom: 2px solid grey; text-align: center;'>0.629</td>\n<td style='border-bottom: 2px solid grey; text-align: center;'>0.1708</td>\n<td style='border-bottom: 2px solid grey; text-align: center;'>0.5466</td>\n<td style='border-bottom: 2px solid grey; text-align: center;'>300</td>\n</tr>\n</tbody>\n</table>\n```\n\n:::\n:::\n\n\n\n* Shrinkage surprisingly close to heuristic estimate of 0.79\n* Now validate 5-year survival probability estimates\n\n\n\n::: {.cell cap='Bootstrap estimate of calibration accuracy for 5-year estimates from the final Cox model, using adaptive linear spline hazard regression.  Line nearer the ideal line corresponds to apparent predictive accuracy.  The blue curve corresponds to bootstrap-corrected estimates.' scap='Bootstrap estimates of calibration accuracy in prostate cancer model'}\n::: {.cell-output .cell-output-stdout}\n\n```\nUsing Cox survival estimates at 60 Months\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Bootstrap estimate of calibration accuracy for 5-year estimates from the final Cox model, using adaptive linear spline hazard regression.  Line nearer the ideal line corresponds to apparent predictive accuracy.  The blue curve corresponds to bootstrap-corrected estimates.](index_files/figure-html/fig-coxcase-cal-1.png){#fig-coxcase-cal fig-scap='Bootstrap estimates of calibration accuracy in prostate cancer model' width=672}\n:::\n:::\n\n\n\n\n## Presenting the Model\n\n\n* Display hazard ratios, overriding default for `ap`\n\n\n\n::: {.cell cap='Hazard ratios and multi-level confidence bars for effects of predictors in model, using default ranges except for `ap`' scap='Hazard ratios for prostate survival model'}\n::: {.cell-output-display}\n![Hazard ratios and multi-level confidence bars for effects of predictors in model, using default ranges except for `ap`](index_files/figure-html/fig-coxcase-summary-1.png){#fig-coxcase-summary fig-scap='Hazard ratios for prostate survival model' width=672}\n:::\n:::\n\n\n\n* Draw nomogram, with predictions stated 4 ways\n\n\n\n\n::: {.cell w='6' h='7' cap='Nomogram for predicting death in prostate cancer trial'}\n::: {.cell-output-display}\n![Nomogram for predicting death in prostate cancer trial](index_files/figure-html/fig-coxcase-nomogram-1.png){#fig-coxcase-nomogram width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}